<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USA Map Search with Mapbox</title>

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />

    <script
        src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" />

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .container {
            display: flex;
            height: 100vh;
            padding: 20px;
        }

        #map {
            width: 50%;
            height: 80vh;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Map -->
        <div id="map"></div>
        <div class="rightSide">
            <h1>USA Map Search with Mapbox</h1>
        </div>
    </div>

    <script>

        mapboxgl.accessToken = 'pk.eyJ1Ijoid2Vid2l0aHJhaiIsImEiOiJjbTBhbGZmMHgxZXFuMm1vcWt4YmNwZGZhIn0.IpNziQwncy2U-Xms017ojA';
        // Map initialization
        const map = new mapboxgl.Map({
            accessToken: mapboxgl.accessToken,
            container: 'map',
            style: 'mapbox://styles/webwithraj/cm1ueo77a012f01qvevdiacid', // Your custom style
            zoom: 4, // Appropriate zoom for USA
            center: [-95.7129, 37.0902], // Center of the USA
        });

        // Define the polygon data
        const polygon = {
            'type': 'FeatureCollection',
            'features': [{
                'type': 'Feature',
                'geometry': {
                    'type': 'Polygon',
                    'coordinates': [
                        [
                            [-100.0, 40.0],
                            [-105.0, 40.0],
                            [-105.0, 45.0],
                            [-100.0, 45.0],
                            [-100.0, 40.0]
                        ]
                    ]
                }
            }]
        };

        // Load polygon and marker layers
        map.on('style.load', () => {
            map.addLayer({
                id: 'polygon-fill',
                type: 'fill',
                source: { type: 'geojson', data: polygon },
                paint: { 'fill-opacity': 0.2, 'fill-color': '#4264fb' },
            });

            map.addLayer({
                id: 'polygon-line',
                type: 'line',
                source: { type: 'geojson', data: polygon },
                paint: { 'line-width': 2, 'line-color': '#4264fb' },
            });
        });

        // Add a marker for the center of the USA
        var marker = new mapboxgl.Marker()
            .setLngLat([-95.7129, 37.0902])
            .addTo(map);

        // Set up the geocoder
        var geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl,
            marker: false,
            placeholder: 'Search for places in the USA',
            bbox: [-125.00165, 24.396308, -66.93457, 49.384358], // Limit search to the USA
            proximity: { longitude: -95.7129, latitude: 37.0902 } // Centered around USA
        });

        // Add the geocoder to the map
        map.addControl(geocoder);

        // Update the map with the search results
        map.on('load', function () {
            map.addSource('single-point', {
                'type': 'geojson',
                'data': { 'type': 'FeatureCollection', 'features': [] }
            });

            map.addLayer({
                'id': 'point',
                'source': 'single-point',
                'type': 'circle',
                'paint': { 'circle-radius': 10, 'circle-color': '#448ee4' }
            });

            // Move marker on search result
            geocoder.on('result', function (e) {
                map.getSource('single-point').setData(e.result.geometry);
            });
        });
    </script>

</body>

</html>